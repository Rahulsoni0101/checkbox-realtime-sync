<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Realtime Checkbox Sync</title>

    <style></style>
  </head>

  <body>
    <div class="container">
      <header>
        <h2>Realtime Checkbox Sync</h2>
        <div class="users">Active Users: <span id="users-count">0</span></div>
      </header>
      <div id="checkbox-container"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io({ transports: ["websocket"] });
      const syncState = async () => {
        const res = await fetch("/state");
        const { checkboxState } = await res.json();

        checkboxState.forEach((value, index) => {
          const checkbox = document.getElementById(`checkbox-${index}`);
          if (checkbox) checkbox.checked = value;
        });
      };

      const checkboxContainer = document.getElementById("checkbox-container");
      const TOTAL_CHECKBOXES = 100;

      for (let i = 0; i < TOTAL_CHECKBOXES; i++) {
        const input = document.createElement("input");
        input.type = "checkbox";
        input.id = `checkbox-${i}`;

        input.addEventListener("change", () => {
          socket.emit("checkbox-update", {
            index: i,
            value: input.checked,
          });
        });

        checkboxContainer.appendChild(input);
      }

      socket.on("server-message", ({ index, value }) => {
        const checkbox = document.getElementById(`checkbox-${index}`);
        if (checkbox) checkbox.checked = value;
      });

      syncState();

      socket.on("state-changed", () => {
        syncState();
      });
    </script>
  </body>
</html>
